{% extends "calculaber_app/base.html" %}
{% block body_block %}

<div class="jumbotron">
  <h2>{{ object_info.name }}</h2>
  <h4>Celková cena {{ total_price }} CZK</h4>
  <a href="{% url 'project_detail' pk=object_info.project_id %}" class="btn btn-info" role="button">Zpět na projekt</a>
  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#UpdateObject">
    Upravit
  </button>
  <a href="{% url 'object_delete' pk=object_info.id %}" class="btn btn-danger" role="button">Smazat</a>
</div>
<table class="table">
  <thead>
    <tr>
      <th scope="col">Díl</th>
      <th scope="col">Množství</th>
      <th scope="col">Materiál</th>
      <th scope="col">Cena materiálu</th>
      <th scope="col">Margin</th>
      <th scope="col">Finální cena</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for material in material_object %}
    <tr>
      <form method="POST" enctype="multipart/form-data">{% csrf_token %}

        <td>
          <input class="form-control" id="customized-{{material.pk}}" name='materialobject_customized' type="text" value="{{material.customized}}" disabled hidden>
          <p id="p_name-{{material.pk}}">{{material.name}}</p>
        </td>
        <td>
          <p id="p_amount-{{material.pk}}">{{material.amount}} {% if material.material.get_units_display == 'm2' %}m<sup>2</sup>{% else %}{{material.material.get_units_display}}{% endif %}</p>
        </td>
        <td>{{material.material.name}}</td>
        {% if material.customized == True %}
          <td><p id="p_price-{{material.pk}}">{{material.price}} CZK</p></td>
          <td><p id="p_margin-{{material.pk}}">{{material.margin}} %</p></td>
        {% else %}
        <td><p id="p_price-{{material.pk}}">{{material.material.price}} CZK</p></td>
        <td><p id="p_margin-{{material.pk}}">{{material.material.margin}} %</p></td>
        {% endif %}
        <td>{% widthratio material.amount 1 material.material.price %}</td>
        <td>
          <button id="edit_item_test-{{material.pk}}" type="button" class="btn btn-primary" data-toggle="modal" data-target="#UpdateMaterialObject">
            Upravit
          </button>
          <form method="POST" action="{% url 'material_object_delete' pk=material.pk %}">
             {% csrf_token %}<input class="btn btn-danger" id="delete_item-{{material.pk}}" type="submit" onclick="return confirm('Jste si jistí, že chcete materiál odebrat?')" value="Smazat">
          </form>
        </td>

      </form>
    </tr>
    {% endfor %}
  </tbody>
</table>
<button title="dil" type="button" class="btn btn-primary" data-toggle="modal" data-target="#NewMaterialObject">
  Nový díl
</button>
{% include "calculaber_app/new_material_object_modal.html" %}
{% include "calculaber_app/update_object_modal.html" %}
{% include "calculaber_app/update_material_object_modal.html" %}

{% endblock %}
